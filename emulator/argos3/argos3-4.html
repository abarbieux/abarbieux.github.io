<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Catch The Ball - KiloGuide</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Catch The Ball";
        var mkdocs_page_input_path = "emulator\\argos3\\argos3-4.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../index.html" class="icon icon-home"> KiloGuide
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Guides</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/guide-index.html">Guides summary (modified by Arthur)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/getting-started.html">Getting started (modified by Arthur)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/coding-for-kilobots.html">Coding for kilobots</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/compile-your-code.html">Compile your code (modified by Arthur)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/transfer-and-run-your-program.html">Transfer and run your program</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/use-the-debug-feature.html">Use the debug feature</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../guides/use-an-emulator.html">Use an Emulator ( added by Arthur)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tuto-index.html">Tutorials summary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tuto1.html">Race Around the World</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tuto2.html">Full Metal Kilobot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tuto3.html">King-o-bot's Games</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tuto4.html">Morphogenetics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../tutorials/tuto5.html">Rush Hour</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Argos3 ( added by Arthur)</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="argos3-index.html">Argos3 summary</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="argos3-1.html">Game of life</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="argos3-2.html">Space Attack</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="argos3-3.html">Magnet</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="argos3-4.html">Catch The Ball</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#context">Context</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#goal">Goal</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#working">Working</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#what-you-will-learn">What you will learn</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#wall-program">WALL program</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#defining-macros-and-global-variables">Defining macros and global variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#the-setup-function">The setup() function</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#the-other-fonction">The other fonction</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#hunter-and-ball-program">Hunter and Ball program</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#defining-macros-and-global-variables_1">Defining macros and global variables</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#the-setup-fonction">The setup() fonction</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#the-loop-fonction">The loop() fonction</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#communication">Communication</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#we-are-done">We are done !</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Kilombo (added by Arthur)</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../kilombo/kilombo-index.html">Kilombo summary</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../about.html">About</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">KiloGuide</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html" class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Argos3 ( added by Arthur) &raquo;</li><li>Catch The Ball</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>

          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="space-attack">Space Attack</h1>
<p><a href="../../resources/sources/Catch_The_Ball.zip"><em>source code of this tutorial</em></a></p>
<hr />
<h2 id="context">Context</h2>
<p>In retirement homes, the physical activity of the occupants is a priority.</p>
<p>Playing to roll the ball in a circle is, for example, a good activity that does not require too much effort from the resident.</p>
<p>However, with limited staff and means, this task is sometimes complicated.</p>
<hr />
<h2 id="goal">Goal</h2>
<p>The goal of this project was to simulate some old people playing at the ball with a hunter trying to catch the ball .</p>
<hr />
<h2 id="working">Working</h2>
<p>There is 3 types of kilobots : </p>
<ul>
<li>The kilobot "ball" moving in the circle by "bouncing off" the "walls".</li>
<li>The kilobot "hunter" moving in the circle him too by bouncing off the walls.</li>
<li>The kilobots "wall" that symbolise the resident. Theu do nothing except send a message with their type to the kilobot ball and hunter.</li>
</ul>
<hr />
<h2 id="what-you-will-learn">What you will learn</h2>
<ul>
<li>How to solve a probleme in real life with the kilobot.</li>
</ul>
<hr />
<h2 id="wall-program">WALL program</h2>
<h3 id="defining-macros-and-global-variables">Defining macros and global variables</h3>
<p>There are 3 macros defined who represente the type of the kilobot and one variable to store the message.</p>
<pre><code class="language-c">
#define BALLE 0
#define HUNTER 1
#define LIMIT 2

message_t message;

</code></pre>
<h3 id="the-setup-function">The <code>setup()</code> function</h3>
<p>The kilobot WALL are only usefull to define the paly area.
So their only goal is to warn the other kilobot that they have arrived at the end of play area.</p>
<pre><code class="language-c">
void setup() {

    //set the message to send
    message.type = NORMAL;
    message.data[0] = LIMIT;
    message.crc = message_crc(&amp;message);

    //set the light
    set_color (RGB(0,0,0));

}
</code></pre>
<h3 id="the-other-fonction">The other fonction</h3>
<pre><code class="language-c">void loop() {
}

//send message
message_t* message_tx(){
    return &amp;message;
}
//check message
void message_rx(message_t *msg, distance_measurement_t *dist) {
}

int main(){
    kilo_init();

    kilo_message_rx = message_rx;

    kilo_message_tx = message_tx;

    kilo_start(setup, loop);

    return 0;
}
</code></pre>
<h2 id="hunter-and-ball-program">Hunter and Ball program</h2>
<h3 id="defining-macros-and-global-variables_1">Defining macros and global variables</h3>
<p>BALLE, HUNTER,LIMIT are used tu define the type of the kilobot.
CATCH, WALL, RUN are used to defined the statd of the kilobot.
Reday and NOTREADY are used to defniend if the kilobot is redy or not.</p>
<pre><code class="language-c">#define BALLE 0
#define HUNTER 1
#define LIMIT 2

#define CATCH 0
#define WALL 1
#define RUN 2

#define READY 0
#define NOTREADY 1
</code></pre>
<p>This varibles are used to :</p>
<ul>
<li>store the state</li>
<li>store if redy or not</li>
<li>had the distance when the ball is considered catch</li>
<li>had the delay to go straight on 1 cm (irl kilobot)</li>
<li>had the delay to make a half turn on himself ( irl kilobot)</li>
<li>store the delay to subtract or add</li>
<li>store the message</li>
</ul>
<pre><code class="language-c">int state;
int ready;
int catch_distance = 100;
int straightSpeedCalibrator = 1000; // Delay in milliseconds to go straight on 1cm (for irl kilobot)
int turningSpeedCalibrator = 2500; // Delay in milliseconds to make 1/2 turn around (for irl kilobot)
int Thedelay;
message_t message;

</code></pre>
<h3 id="the-setup-fonction">The <code>setup()</code> fonction</h3>
<p>The difference between Hunter and Ball is that "message.data[0] = Hunter" is equal at "BALL" in Ball.</p>
<pre><code class="language-c">
void setup() {
    //set de random seed
    rand_seed(1);
    //set the state
    state = RUN;
    ready = READY;

    //set the message to send
    message.type = NORMAL;
    message.data[0] = HUNTER;
    message.crc = message_crc(&amp;message);

    //set the light and movement
    set_color (RGB(3,0,0));

}

</code></pre>
<h3 id="the-loop-fonction">The <code>loop()</code> fonction</h3>
<pre><code class="language-c">
In the loop fonction the kilobot will go forward until it encounters an obstacle.
If it is the Hunter or the Ball, it is the end of the game.
But if it is a wall, the kilobot wiil make a maneuver to turn on itself randomly and return to the circle.


void loop() {


    if (state == RUN){
        // waiting  hunter get away
        if (ready == NOTREADY) {
            set_motors(kilo_straight_left, kilo_straight_right);
            delay(straightSpeedCalibrator);
            ready = READY;
        }
        set_color (RGB(3,0,0)); //red
        //go straight
        spinup_motors();
        set_motors(kilo_straight_left, kilo_straight_right);

    }


    //end the simulation, the balle is catch
    else if (state == CATCH) {
        ready = NOTREADY;
        set_color (RGB(0,3,0));
        set_motors(0,0);
    }
    // use to not apply a new message during the rotation
    else if (state == WALL){
        ready = NOTREADY;

        //choice a random direction in the circle
        int rotate = rand_soft() %501 ; //0 to 500

        int more_less = rand_soft() %2; //0 or 1
        //make an &quot;+&quot;
        if (more_less == 1){
            Thedelay = (turningSpeedCalibrator + rotate);
        }
        //make a &quot;-&quot;
        else{
            Thedelay = (turningSpeedCalibrator - rotate);
        }
        //change state to RUN again and turn the hunter
        more_less = rand_soft() %2; //0 or 1
        spinup_motors();
        //turn right or left
        if (more_less == 1){
            set_motors(kilo_turn_left, 0);
        }
        else{
            set_motors(kilo_turn_right, 0);
        }
        delay(Thedelay);
        state = RUN;


    }

}
</code></pre>
<h3 id="communication">Communication</h3>
<p>If receive a message from the Ball, end of the game
Else if receive a message from a wall, pass the state to wall to make a maneuver.
Same logic for the Hunter except it has to  receive a message from the ball.</p>
<pre><code class="language-c">//send a message
message_t* message_tx(){
    return &amp;message;
}
// check a message
void message_rx(message_t *msg, distance_measurement_t *dist) {
    if (estimate_distance(dist) &lt; (catch_distance) ){

        if (msg-&gt;data[0] == BALLE){
            state = CATCH;
        }
        else if (state == RUN &amp;&amp; ready == READY) {
            if (msg-&gt;data[0] == LIMIT){
                state = WALL;
            }
        }   
    }
}

## Put it together!


int main(){
    kilo_init();

    kilo_message_rx = message_rx;

    kilo_message_tx = message_tx;

    kilo_start(setup, loop);

    return 0;
}
</code></pre>
<hr />
<h2 id="we-are-done">We are done !</h2>
<p>You can now admire your kilobot burn the tarmac ! Well, it might not be that impressive. The kilobots were probably not designed as racing machines. But fair enough, it at least made you learn the basics of programming for kilobots !</p>
<hr />
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="argos3-3.html" class="btn btn-neutral float-left" title="Magnet"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../kilombo/kilombo-index.html" class="btn btn-neutral float-right" title="Kilombo summary">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="argos3-3.html" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../kilombo/kilombo-index.html" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
